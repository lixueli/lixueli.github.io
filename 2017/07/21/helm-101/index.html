<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Helm 101 · Li Xueli Blog</title><meta name="description" content="Helm 101 - Li Xueli"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://lixueli.com/atom.xml" title="Li Xueli Blog"><script>(function(h,o,t,j,a,r){h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};h._hjSettings={hjid:2010052,hjsv:6};a=o.getElementsByTagName("head")[0];r=o.createElement("script");r.async=1;r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;a.appendChild(r)})(window,document,"https://static.hotjar.com/c/hotjar-",".js?sv=");</script></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">文章</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/labs/" target="_self" class="nav-list-link">实验室</a></li><li class="nav-list-item"><a href="https://space.bilibili.com/7278038/#/" target="_blank" class="nav-list-link">视频</a></li><li class="nav-list-item"><a href="/contact/" target="_self" class="nav-list-link">联系我</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><div class="toc-tree"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#关于-Helm"><span class="toc-text">关于 Helm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基本概念"><span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#准备"><span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装-Helm"><span class="toc-text">安装 Helm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#初始化-Helm-安装-Tiller"><span class="toc-text">初始化 Helm 安装 Tiller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查找-chart"><span class="toc-text">查找 chart</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装-chart"><span class="toc-text">安装 chart</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义-chart-配置"><span class="toc-text">自定义 chart 配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查看-release-状态"><span class="toc-text">查看 release 状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查看-release-列表"><span class="toc-text">查看 release 列表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#升级-release"><span class="toc-text">升级 release</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#回滚-release"><span class="toc-text">回滚 release</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除-release"><span class="toc-text">删除 release</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建自己的-chart"><span class="toc-text">创建自己的 chart</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取帮助信息"><span class="toc-text">获取帮助信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-text">参考资料</span></a></li></ol></div><div class="tag"><a class='tag-link' href='/tags/开发/'>开发</a>    <a class='tag-link' href='/tags/k8s/'>k8s</a></div><article class="post-block"><h1 class="post-title">Helm 101</h1><div class="post-info">2017年7月21日</div><div class="post-content"><p>开始在 Kubernetes 中使用 Helm。</p>
<a id="more"></a>
<h2 id="关于-Helm"><a href="#关于-Helm" class="headerlink" title="关于 Helm"></a>关于 Helm</h2><p>Helm（意思：舵）是 Kubernetes（希腊语含义：舵手）的应用管理工具。Tiller（意思：舵柄）是 Helm 的服务器部分，通常运行在 K8s 集群内部。</p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p><strong>Chart</strong></p>
<p>一个 <em>chart</em> 就是一个 Helm 包，包含应用所需要的各种资源、工具和服务，类似Homebrew 的 formula。</p>
<p><strong>Repository</strong></p>
<p><em>Repository</em>（仓库）是存放 <em>chart</em> 的地方。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">查看 Repository 列表</span><br><span class="line">$ helm repo list</span><br><span class="line">添加 Repository</span><br><span class="line">$ helm repo add &lt;repo_name&gt; &lt;repo_address&gt;</span><br><span class="line">更新各个 Repository 中的 chart 列表</span><br><span class="line">$ helm repo update</span><br></pre></td></tr></table></figure></p>
<p><strong>Release</strong></p>
<p><em>Release</em> 是 K8s 集群内部运行的 <em>chart</em> 的一个实例，同一个 <em>chart</em> 可以创建多个独立的实例。</p>
<p>总结起来就是：Helm 往 Kubernetes 中安装 chart, 每一次安装都创建一个 release 实例。通过搜索 Helm chart 仓库可以找到你想要的 chart。</p>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ul>
<li>已经安装 Kubernetes，建议 1.4.1 版本或更新。</li>
<li><p>本地有 kubectl 的配置文件，Helm 的服务端 Tiller 将安装在 kuberctl config 对应的集群中，可通过：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl config current-context</span><br><span class="line">minikube</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置 Helm 命令行自动补全工具，在 <code>.bashrc</code> 或 <code>.zshrc</code> 中添加：</p>
<ul>
<li><code>$ source &lt;(helm completion &lt;shell_type&gt;)</code>，<code>shell_type</code> 为 <code>bash</code> 或 <code>zsh</code></li>
</ul>
</li>
</ul>
<h2 id="安装-Helm"><a href="#安装-Helm" class="headerlink" title="安装 Helm"></a>安装 Helm</h2><p><strong>1. 通过二进制包安装：</strong></p>
<ul>
<li>在  <a href="https://github.com/kubernetes/helm/releases" target="_blank" rel="noopener">这里</a> 下载需要的版本</li>
<li>通过 <code>tar -zxvf helm-v2.0.0-linux-amd64.tgz</code> 解压缩文件</li>
<li>将二进制文件移动到 <code>/usr/local/bin/helm</code> 文件夹： <code>mv linux-amd64/helm /usr/local/bin/helm</code></li>
</ul>
<p><strong>2. MacOS 通过 homebrew 安装：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install helm</span><br></pre></td></tr></table></figure></p>
<h2 id="初始化-Helm-安装-Tiller"><a href="#初始化-Helm-安装-Tiller" class="headerlink" title="初始化 Helm 安装 Tiller"></a>初始化 Helm 安装 Tiller</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm init</span><br></pre></td></tr></table></figure>
<ul>
<li>如果想安装在指定的集群，使用 <code>--kube-context</code></li>
<li>升级 Tiller 可以直接运行：<code>helm init --upgrade</code></li>
</ul>
<h2 id="查找-chart"><a href="#查找-chart" class="headerlink" title="查找 chart"></a>查找 chart</h2><p>搜索 chart，可使用正则，会匹配 chart 名和描述。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ helm search &lt;keyword&gt;</span><br><span class="line">-r, --regexp           use regular expressions for searching</span><br><span class="line">-v, --version string   search using semantic versioning constraints</span><br><span class="line">-l, --versions         show the long listing, with each version of each chart on its own line</span><br><span class="line">Options inherited from parent commands</span><br></pre></td></tr></table></figure></p>
<p>查看某个具体 chart 的简介<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ helm inspect &lt;chart_name&gt;</span><br><span class="line">$ helm inspect chart &lt;chart_name&gt;</span><br><span class="line">$ helm inspect values &lt;chart_name&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="安装-chart"><a href="#安装-chart" class="headerlink" title="安装 chart"></a>安装 chart</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ helm install stable/mysql</span><br><span class="line">NAME:   angry-kudu # 构建了一个叫 angry-kudu 的 release</span><br><span class="line">LAST DEPLOYED: Thu Jul 20 14:50:53 2017</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: DEPLOYED</span><br><span class="line"></span><br><span class="line">RESOURCES:</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">NOTES:</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>在安装 chart 之前，可以通过：</p>
<ul>
<li><code>$ helm repo update</code> 来更新仓库中的最新可用 charts 列表。</li>
<li><code>$ helm search xxx</code> 来搜索想要安装的 chart 是否存在。</li>
</ul>
<h2 id="自定义-chart-配置"><a href="#自定义-chart-配置" class="headerlink" title="自定义 chart 配置"></a>自定义 chart 配置</h2><p>直接安装使用的是默认的配置，如果想自定义配置，可以根据 chart 提供的配置项，自定义配置文件，然后再创建 release。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ helm inspect values &lt;chart_name&gt;</span><br><span class="line">$ echo &apos;&#123;mariadbUser: user0, mariadbDatabase: user0db&#125;&apos; &gt; config.yaml</span><br><span class="line">$ helm install -f config.yaml stable/mariadb</span><br></pre></td></tr></table></figure></p>
<h2 id="查看-release-状态"><a href="#查看-release-状态" class="headerlink" title="查看 release 状态"></a>查看 release 状态</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ helm status &lt;release_name&gt;</span><br><span class="line">LAST DEPLOYED: Thu Jul 20 14:50:53 2017</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: DEPLOYED</span><br><span class="line"></span><br><span class="line">RESOURCES:</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">NOTES:</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="查看-release-列表"><a href="#查看-release-列表" class="headerlink" title="查看 release 列表"></a>查看 release 列表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">查看 release</span><br><span class="line">$ helm list</span><br><span class="line">或简写为</span><br><span class="line">$ helm ls</span><br><span class="line"></span><br><span class="line">--all 可以查看所有 release（包括被删除的）</span><br><span class="line">$ helm list --all</span><br></pre></td></tr></table></figure>
<h2 id="升级-release"><a href="#升级-release" class="headerlink" title="升级 release"></a>升级 release</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ helm upgrade &lt;release_name&gt; &lt;chart_name&gt;</span><br><span class="line">如</span><br><span class="line">$ helm upgrade -f update.yaml &lt;release_name&gt; &lt;chart_name&gt;</span><br><span class="line">$ helm upgrade --set &lt;key&gt;=&lt;value&gt; &lt;release_name&gt; &lt;chart_name&gt;</span><br></pre></td></tr></table></figure>
<h2 id="回滚-release"><a href="#回滚-release" class="headerlink" title="回滚 release"></a>回滚 release</h2><p>使用 <code>helm rollback</code> 回滚到之前的版本，回滚之后也会创建一个 revision。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm rollback &lt;release_name&gt; &lt;revision_number&gt;</span><br></pre></td></tr></table></figure></p>
<p>查看 release 的各个 revision 版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm history &lt;release_name&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="删除-release"><a href="#删除-release" class="headerlink" title="删除 release"></a>删除 release</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ helm delete angry-kudu</span><br><span class="line">release &quot;dining-antelope&quot; deleted</span><br></pre></td></tr></table></figure>
<h2 id="创建自己的-chart"><a href="#创建自己的-chart" class="headerlink" title="创建自己的 chart"></a>创建自己的 chart</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">创建 chart</span><br><span class="line">$ helm create &lt;chart_name&gt;</span><br><span class="line"></span><br><span class="line">检查 chart 是否符合规范</span><br><span class="line">$ helm lint</span><br><span class="line"></span><br><span class="line">打包 chart</span><br><span class="line">$ helm package deis-workflow</span><br><span class="line">deis-workflow-0.1.0.tgz</span><br><span class="line"></span><br><span class="line">安装</span><br><span class="line">$ helm install ./deis-workflow-0.1.0.tgz</span><br></pre></td></tr></table></figure>
<h2 id="获取帮助信息"><a href="#获取帮助信息" class="headerlink" title="获取帮助信息"></a>获取帮助信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm &lt;command_name&gt; -h</span><br></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a href="https://docs.helm.sh/using_helm/" target="_blank" rel="noopener">Helm Documentation - Using Helm</a></li>
<li><a href="https://docs.helm.sh/helm/" target="_blank" rel="noopener">Helm Documentation - Helm Commands</a></li>
</ol>
</div></article></div><div class="cc">版权声明：<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">非商业性使用-禁止演绎 3.0(CC BY-NC-ND 3.0)</a></div></main><footer><div class="paginator"><a href="/2017/09/11/electron-1/" class="prev">上一篇</a><a href="/2017/07/11/resources-recommendation/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'lixueli';
var disqus_identifier = '2017/07/21/helm-101/';
var disqus_title = 'Helm 101';
var disqus_url = 'http://lixueli.com/2017/07/21/helm-101/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//lixueli.disqus.com/count.js" async></script><div class="copyright"><p>© 2017 - 2021 <a href="http://lixueli.com">Li Xueli</a>, powered <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/mixj93/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-112756013-1",'auto');ga('send','pageview');</script></body></html>