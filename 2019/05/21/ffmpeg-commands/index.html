<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 我的ffmpeg常用命令 · Li Xueli Blog</title><meta name="description" content="我的ffmpeg常用命令 - Li Xueli"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://lixueli.com/atom.xml" title="Li Xueli Blog"><script>(function(h,o,t,j,a,r){h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};h._hjSettings={hjid:2010052,hjsv:6};a=o.getElementsByTagName("head")[0];r=o.createElement("script");r.async=1;r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;a.appendChild(r)})(window,document,"https://static.hotjar.com/c/hotjar-",".js?sv=");</script></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">文章</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/labs/" target="_self" class="nav-list-link">实验室</a></li><li class="nav-list-item"><a href="https://space.bilibili.com/7278038/#/" target="_blank" class="nav-list-link">视频</a></li><li class="nav-list-item"><a href="/contact/" target="_self" class="nav-list-link">联系我</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><div class="toc-tree"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#查看视频信息"><span class="toc-text">查看视频信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#剪辑"><span class="toc-text">剪辑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#指定间隔截图"><span class="toc-text">指定间隔截图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#左右拼接"><span class="toc-text">左右拼接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#合并"><span class="toc-text">合并</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ffmpeg-压制带字幕视频"><span class="toc-text">ffmpeg 压制带字幕视频</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1280-640"><span class="toc-text">1280*640</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1280-640-gt-1280-720-加黑边"><span class="toc-text">1280*640 -&gt; 1280*720 加黑边</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1920-1080-H265-gt-H264"><span class="toc-text">1920*1080 H265 -&gt; H264</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#视频加封面图片"><span class="toc-text">视频加封面图片</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flac-转-mp3"><span class="toc-text">flac 转 mp3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#去片头片尾"><span class="toc-text">去片头片尾</span></a></li></ol></div><div class="tag"></div><article class="post-block"><h1 class="post-title">我的ffmpeg常用命令</h1><div class="post-info">2019年5月21日</div><div class="post-content"><p>我的ffmpeg，ffprobe常用命令</p>
<a id="more"></a>
<h2 id="查看视频信息"><a href="#查看视频信息" class="headerlink" title="查看视频信息"></a>查看视频信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffprobe video.mp4</span><br></pre></td></tr></table></figure>
<p>输出含义：</p>
<ul>
<li>tbn = the time base in AVStream that has come from the container</li>
<li>tbc = the time base in AVCodecContext for the codec used for a particular stream</li>
<li>tbr = tbr is guessed from the video stream and is the value users want to see when they look for the video frame rate</li>
</ul>
<p><a href="http://www.ffmpeg-archive.org/What-does-the-output-of-ffmpeg-mean-tbr-tbn-tbc-etc-td941538.html" target="_blank" rel="noopener">FFmpeg-users - What does the output of ffmpeg mean? tbr tbn tbc etc?</a></p>
<h2 id="剪辑"><a href="#剪辑" class="headerlink" title="剪辑"></a>剪辑</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -ss 0:0:4.000 -t 0:2:00 -i input.mp4 -vcodec copy -acodec copy out.mp4 #不重新编码</span><br><span class="line">ffmpeg -ss 0:0:4.000 -t 0:2:00 -i input.mp4 -vcodec h264 -acodec aac out.mp4 #重新编码</span><br></pre></td></tr></table></figure>
<h2 id="指定间隔截图"><a href="#指定间隔截图" class="headerlink" title="指定间隔截图"></a>指定间隔截图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -ss 00:00:10.000 -i sense8.S01E03.start.mp4  -vf fps=fps=10 ../screenshots/screen-%03d.jpg</span><br><span class="line"># fps 后数值越大，截图越多</span><br></pre></td></tr></table></figure>
<h2 id="左右拼接"><a href="#左右拼接" class="headerlink" title="左右拼接"></a>左右拼接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i left.mp4 -i right.mp4 -filter_complex \</span><br><span class="line">&quot;[0:v:0]pad=iw*2:ih[bg]; [bg][1:v:0]overlay=w&quot; output.mp4</span><br></pre></td></tr></table></figure>
<h2 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i &quot;concat:input1.flv|input2.flv|input3.flv&quot; -c copy output.mp4</span><br></pre></td></tr></table></figure>
<h2 id="ffmpeg-压制带字幕视频"><a href="#ffmpeg-压制带字幕视频" class="headerlink" title="ffmpeg 压制带字幕视频"></a>ffmpeg 压制带字幕视频</h2><h3 id="1280-640"><a href="#1280-640" class="headerlink" title="1280*640"></a>1280*640</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mkv -map 0:0 -map 0:1 -c:a aac -ab 192k -strict -2 -async 1 -c:v libx264 -crf 23 -r 25 -s 1280x640 -aspect 2:1 -pix_fmt yuv420p -partitions partb8x8+partp4x4+partp8x8+parti8x8 -b-pyramid 1 -weightb 1 -8x8dct 1 -fast-pskip 1 -direct-pred 1 -coder ac -trellis 1 -me_method hex -subq 6 -me_range 16 -bf 3 -b_strategy 1 -refs 3 -flags +loop -sws_flags fast_bilinear -sc_threshold 40 -keyint_min 25 -g 50 -qmin 3 -qmax 51 -qdiff 4 -metadata creation_time=now -vf subtitles=&quot;sub.ass&quot;:charenc=utf-8 -sn -y output.mp4</span><br></pre></td></tr></table></figure>
<h3 id="1280-640-gt-1280-720-加黑边"><a href="#1280-640-gt-1280-720-加黑边" class="headerlink" title="1280*640 -&gt; 1280*720 加黑边"></a>1280*640 -&gt; 1280*720 加黑边</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mkv -map 0:0 -map 0:1 -c:a aac -ab 320k -strict -2 -async 1 -c:v libx264 -crf 20 -r 24000/1001 -s 1280x720 -aspect 2:1 -pix_fmt yuv420p -partitions partb8x8+partp4x4+partp8x8+parti8x8 -b-pyramid 1 -weightb 1 -8x8dct 1 -fast-pskip 1 -direct-pred 1 -coder ac -trellis 1 -me_method hex -subq 6 -me_range 16 -bf 3 -b_strategy 1 -refs 3 -flags +loop -sws_flags fast_bilinear -sc_threshold 40 -keyint_min 24 -g 48 -qmin 3 -qmax 51 -qdiff 4 -threads 1 -metadata creation_time=now -vf scale=iw*1:ih,&quot;pad=max(iw\,ih*(16/9)):ow/(16/9):(ow-iw)/2:(oh-ih)/2&quot; -sn -aspect 16:9 -y output.mp4</span><br></pre></td></tr></table></figure>
<h3 id="1920-1080-H265-gt-H264"><a href="#1920-1080-H265-gt-H264" class="headerlink" title="1920*1080 H265 -&gt; H264"></a>1920*1080 H265 -&gt; H264</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -map 0:0 -map 0:1 -c:a aac -ab 192k -strict -2 -async 1 -c:v libx264 -crf 20 -r 24 -s 1920x1080 -aspect 16:9 -pix_fmt yuv420p -partitions partb8x8+partp4x4+partp8x8+parti8x8 -b-pyramid 1 -weightb 1 -8x8dct 1 -fast-pskip 1 -direct-pred 1 -coder ac -trellis 1 -me_method hex -subq 6 -me_range 16 -bf 3 -b_strategy 1 -refs 3 -flags +loop -sws_flags fast_bilinear -sc_threshold 40 -keyint_min 24 -g 48 -qmin 3 -qmax 51 -qdiff 4 -threads 1 -metadata creation_time=now -sn -y output.mp4</span><br></pre></td></tr></table></figure>
<h2 id="视频加封面图片"><a href="#视频加封面图片" class="headerlink" title="视频加封面图片"></a>视频加封面图片</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i INPUT.mp4 -i IMAGE.png -acodec copy -vcodec copy -map 0 -map 1:0 OUTPUT.mp4</span><br><span class="line">ffmpeg -i video.mp4 -i image.png -map 0 -map 1 -c copy -c:v:1 png -disposition:v:1 attached_pic out.mp4</span><br><span class="line"># best</span><br><span class="line">ffmpeg -i &lt;video.mp4&gt; -i &lt;cover.jpg&gt; -map 1 -map 0 -c copy -disposition:0 attached_pic out.mp4</span><br></pre></td></tr></table></figure>
<h2 id="flac-转-mp3"><a href="#flac-转-mp3" class="headerlink" title="flac 转 mp3"></a>flac 转 mp3</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.flac -ab 320k -map_metadata 0 -id3v2_version 3 output.mp3</span><br></pre></td></tr></table></figure>
<h2 id="去片头片尾"><a href="#去片头片尾" class="headerlink" title="去片头片尾"></a>去片头片尾</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -ss 30 -i test.mp4 -map 0:0 -map 0:1 -c:a aac -ab 96k -strict -2 -async 1 -c:v libx264 -b:v 1414k -maxrate 2828k -bufsize 2828k -r 24 -s 1280x720 -aspect 1280:720 -pix_fmt yuv420p -partitions partb8x8+partp4x4+partp8x8+parti8x8 -b-pyramid 1 -weightb 1 -8x8dct 1 -fast-pskip 1 -direct-pred 1 -coder ac -trellis 1 -me_method hex -subq 6 -me_range 16 -bf 3 -b_strategy 1 -refs 3 -flags +loop -sws_flags fast_bilinear -sc_threshold 40 -keyint_min 24 -g 48 -qmin 3 -qmax 51 -threads 1 -metadata creation_time=now -sn -t 1034 -y test_0.mp4</span><br></pre></td></tr></table></figure>
</div></article></div><div class="cc">版权声明：<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">非商业性使用-禁止演绎 3.0(CC BY-NC-ND 3.0)</a></div></main><footer><div class="paginator"><a href="/2019/09/19/fetch-helm-release-slow/" class="prev">上一篇</a><a href="/2018/10/09/merge-git-commits/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'lixueli';
var disqus_identifier = '2019/05/21/ffmpeg-commands/';
var disqus_title = '我的ffmpeg常用命令';
var disqus_url = 'http://lixueli.com/2019/05/21/ffmpeg-commands/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//lixueli.disqus.com/count.js" async></script><div class="copyright"><p>© 2017 - 2021 <a href="http://lixueli.com">Li Xueli</a>, powered <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/mixj93/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-112756013-1",'auto');ga('send','pageview');</script></body></html>